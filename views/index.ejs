<%- include('partials/layout', { title: 'Home' }) %>

<div class="container mt-5">
  <h3>Employee List</h3>
 
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Department</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="employeeTable">
    </tbody>
  </table>

  <a href="/add-employee" class="btn btn-success mb-3">Add New Employee</a>
</div>

  <footer class="bg-light text-center py-3 mt-5">
    <p>&copy; 2025 Apollonia Dental Practice</p>
  </footer>
</div>

<script
  src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
  crossorigin="anonymous"
></script>
<script
  src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
  crossorigin="anonymous"
></script>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"
></script>


<script>
  // Employee fetching and actions
  document.addEventListener("DOMContentLoaded", function () {
    fetchEmployees();
  });

  function fetchEmployees() {
    fetch("/api/employees")
      .then((response) => response.json())
      .then((data) => {
        console.log("employees:",data);
        const table = document.getElementById("employeeTable");
        table.innerHTML = "";
        data.forEach((employee) => {
          const row = `
          <tr>
            <td>${employee.name} ${employee.surname}</td>
            <td>${employee.department.name}</td>
            <td>
              <button class="btn btn-warning" onclick="editEmployee('${employee._id}')">Edit</button>
              <button class="btn btn-danger" onclick="deleteEmployee('${employee._id}')">Delete</button>
            </td>
          </tr>
        `;
          table.innerHTML += row;
        });
      })
      .catch((err) => console.error("Error fetching employees:", err));
  }

  function editEmployee(id) {
    fetch(`api/employees/${id}`, { method: "PUT" })
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("employeeName").value = data.name;
        document.getElementById("employeeDepartment").value =
          data.department._id;
        document.getElementById("employeeForm").dataset.id = data._id; // Store employee ID for update
      })
      .catch((err) => console.error("Error editing employee:", err));
  }

  function deleteEmployee(id) {
    fetch(`/api/employees/${id}`, { method: "DELETE" })
      .then(() => {
        fetchEmployees();
      })
      .catch((err) => console.error("Error deleting employee:", err));
  }
</script>
</body>
</html>


